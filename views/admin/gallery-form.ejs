<%- include('../partials/header') %>

<main class="admin-container">
  <div class="admin-header">
    <h1><%= item && item._id ? 'Edit' : 'Add' %> Gallery Item</h1>
    <div class="admin-actions">
      <a class="btn-secondary" href="/admin">Dashboard</a>
      <a href="/admin/gallery" class="btn-admin">Back to list</a>
    </div>
  </div>

  <div class="admin-card">
    <% if (errors && errors.length) { %>
      <ul>
        <% errors.forEach(function(e){ %>
          <li style="color:red"><%= e %></li>
        <% }) %>
      </ul>
    <% } %>

    <form class="admin-form" method="post" action="<%= item && item._id ? ('/admin/gallery/' + item._id) : '/admin/gallery' %>" enctype="multipart/form-data">
      <label>Title
        <input name="title" value="<%= item && item.title ? item.title : '' %>" required>
      </label>

      <label>Category
        <select name="category">
          <% const categories = ['Uncategorized','Residential','Commercial','Renovation']; %>
          <% categories.forEach(function(c){ %>
            <option value="<%= c %>" <%= (item && item.category === c) ? 'selected' : '' %>><%= c %></option>
          <% }) %>
        </select>
      </label>

      <label>Caption
        <textarea name="caption"><%= item && item.caption ? item.caption : '' %></textarea>
      </label>

      <label>Image file (choose to upload)
        <input id="imageFile" type="file" name="image" accept="image/*">
      </label>

      <label>Or Image URL
        <input id="imageUrl" name="imageUrl" value="<%= item.imageUrl || '' %>">
      </label>

      <div id="previewWrap">
        <% if (item && item.imageUrl) { %>
          <img id="preview" src="<%= item.imageUrl %>" class="admin-image-preview" alt="preview">
        <% } else { %>
          <img id="preview" src="" class="admin-image-preview" alt="preview" style="display:none">
        <% } %>
      </div>

      <div style="margin-top:12px">
        <button class="btn-admin" type="submit">Save</button>
      </div>
    </form>
  </div>
</main>

<script>
  (function(){
    const file = document.getElementById('imageFile');
    const url = document.getElementById('imageUrl');
    const preview = document.getElementById('preview');
    const previewWrap = document.getElementById('previewWrap');
    function showPreview(src){
      if (!preview) return;
      if (!src) { preview.style.display = 'none'; preview.src = ''; return; }
      preview.src = src; preview.style.display = 'block';
    }
    if (file) file.addEventListener('change', function(){
      const f = this.files && this.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = function(e){ showPreview(e.target.result); }
      reader.readAsDataURL(f);
    });
    if (url) url.addEventListener('input', function(){ showPreview(this.value.trim()); });
  })();
</script>

<%- include('../partials/footer') %>